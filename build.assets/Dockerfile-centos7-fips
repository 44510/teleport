ARG BUILDARCH
ARG BUILDBOX_CENTOS7
FROM ${BUILDBOX_CENTOS7}-${BUILDARCH}

# Enable FIPS mode (BoringCrypto) for Go
# https://github.com/golang/go/blob/master/src/crypto/internal/boring/README.md
ENV GOEXPERIMENT=boringcrypto

# Enable OpenSSL FIPS mode by default
# https://www.openssl.org/docs/man3.0/man7/fips_module.html
RUN echo 'config_diagnostics = 1\n\
openssl_conf = openssl_init\n\
\n\
.include /usr/local/ssl/fipsmodule.cnf\n\
\n\
[openssl_init]\n\
providers = provider_sect\n\
\n\
[provider_sect]\n\
fips = fips_sect\n\
base = base_sect\n\
\n\
[base_sect]\n\
activate = 1\n\
' > /usr/local/ssl/openssl.cnf

ENV OPENSSL_FIPS=1
