---
title: Deploy a Teleport Cluster on Kubernetes
description: Get started with Teleport on a Kubernetes cluster
---

Teleport can provide secure, unified access to your Kubernetes clusters. This
guide will show you how to deploy Teleport in a Kubernetes cluster.

We will deploy the following Teleport components:

- **Teleport Auth Service:** The certificate authority for your cluster. It
  issues certificates and conducts authentication challenges.
- **Teleport Proxy Service:** The cluster frontend, which handles user requests,
  forwards user credentials to the Auth Service, and communicates with Teleport
  instances that enable access to specific resources in your infrastructure.
- **Teleport Kubernetes Service:** Teleport service that enables access to the
  Kubernetes cluster where you have deployed the Auth Service and Proxy Service.
  Teleport automatically detects that it is running on Kubernetes and allows
  access to its host cluster.

While completing this guide, you will deploy two pods, one running the Auth
Service and one running the Proxy Service. You will also deploy a load balancer
that allows outside traffic to your Teleport cluster. 

Once you have deployed the cluster, you can register resources like as SSH
servers, databases, and Kubernetes clusters you want to manage access to.

(!docs/pages/includes/cloud/call-to-action.mdx!)

## Follow along with our video guide

<iframe
  width="712"
  height="400"
  src="https://www.youtube-nocookie.com/embed/VPGYLEMTdJ8?rel=0&modestbranding=1"
  frameBorder="0"
  allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"
  allowFullScreen
/>

## Prerequisites

- A registered domain name. This is required for Teleport to set up TLS via
  Let's Encrypt and for Teleport clients to verify the Proxy Service host.
- The `tsh`  client tool installed on your workstation. You can download these
  from our [installation page](../installation.mdx).
- A Kubernetes cluster
  v(=kubernetes.major_version=).(=kubernetes.minor_version=)+ hosted by a cloud
  provider, which is required for the load balancer we deploy in this guide. 
- Helm v(=helm.version=)+ installed on your workstation.

<Admonition title="Alternative guides" type="tip">

- Teleport also supports Kubernetes in on-premise and air-gapped environments.
  If you would like to try out Teleport quickly on your local machine, we
  recommend following our guide to using a [local Kubernetes
  cluster](../../try-out-teleport/local-kubernetes.mdx).

- If you are already running Teleport on another platform, you can use your
  existing Teleport deployment to access your Kubernetes cluster. [Follow our
  guide](../../kubernetes-access/getting-started.mdx) to connect your Kubernetes
  cluster to Teleport.

</Admonition>

(!docs/pages/includes/helm-k8s.mdx!)

(!docs/pages/includes/permission-warning.mdx!)

## Step 1/3. Install Teleport

In this step, you will launch the Teleport Auth Service and Proxy Service on
Kubernetes with the `teleport-cluster` Helm chart.

### Install the `teleport-cluster` chart

(!docs/pages/kubernetes-access/helm/includes/helm-repo-add.mdx!)

Run the following commands to install the chart, specifying your Teleport
cluster name (e.g., `teleport.example.com`) and email address by filling in <Var
name="cluster-name" /> and <Var name="email" />. The cluster name should be a
subdomain of the domain name you registered before beginning this guide.
Teleport uses the email address for notifications related to your cluster's TLS
credentials:

<Tabs>
  <TabItem label="Open Source">
    ```code
    # Install a single node teleport cluster and provision a cert using ACME.
    # Set clusterName to unique hostname, for example tele.example.com
    # Set acmeEmail to receive correspondence from Letsencrypt certificate authority.
    $ helm install teleport-cluster teleport/teleport-cluster \
      --create-namespace \
      --namespace=teleport-cluster \
      --set clusterName=<Var name="cluster-name" /> \
      --set acme=true \
      --set acmeEmail=<Var name="email-address" /> \
      --version (=teleport.version=)
    ```    
  </TabItem>

  <TabItem label="Enterprise" scope={["enterprise"]}>

  (!docs/pages/includes/enterprise/obtainlicense.mdx!)

  Save your license file as `license.pem`, then run the following commands to
  launch your Teleport cluster:

    ```code
    # Create a namespace for a deployment.
    $ kubectl create namespace teleport-cluster

    # Set the kubectl context to the namespace to save some typing
    $ kubectl config set-context --current --namespace=teleport-cluster

    # Get a license from Teleport and create a secret called "license" in the
    # namespace you created
    $ kubectl create secret generic license --from-file=license.pem

    # Install Teleport
    $ helm install teleport-cluster teleport/teleport-cluster \
      --namespace=teleport-cluster \
      --version (=teleport.version=) \
      --set clusterName=<Var name="cluster-name" /> \
      --set acme=true \
      --set enterprise=true \
      --set acmeEmail=<Var name="email-address" /> 
    ```

  </TabItem>
</Tabs>

Verify that there are Teleport pods running in your Kubernetes cluster.

```code
$ kubectl get pods
```

There should be one pod for the Auth Service and one for the Proxy Service:

```text
NAME                                      READY   STATUS    RESTARTS   AGE
teleport-cluster-auth-000000000-00000     1/1     Running   0          7m35s
teleport-cluster-proxy-0000000000-00000   1/1     Running   0          7m35s
```

<Notice type="tip">

If a pod's status is `Pending`, use the `kubectl logs` and `kubectl describe`
commands for that pod to check the status. The Auth Service pod relies on being
able to allocate a persistent volume claim, and may enter a `Pending` state if
no persistent volume is available.

</Notice>

### Set up DNS records for your Teleport cluster

Teleport's Helm chart uses an external load balancer to create a public IP for
Teleport. 

<Details title="More information about external load balancers">

A Kubernetes service can specify its type as `LoadBalancer`, meaning that
Kubernetes expects your cloud provider to proxy traffic to the service via a
managed load balancer.

</Details>

Retrieve the IP address or hostname for your load balancer by running the
following commands:

```code
# Set kubectl context to the namespace to save some typing
$ kubectl config set-context --current --namespace=teleport-cluster

# Service is up, load balancer is created
$ kubectl get services
NAME                    TYPE           CLUSTER-IP   EXTERNAL-IP      PORT(S)                        AGE
teleport-cluster        LoadBalancer   10.4.4.73    104.199.126.88   443:31204/TCP,3026:32690/TCP   89s
teleport-cluster-auth   ClusterIP      10.4.2.51    <none>           3025/TCP,3026/TCP              89s

# Save the pod IP or hostname.
$ SERVICE_IP=$(kubectl get services teleport-cluster -o jsonpath='{.status.loadBalancer.ingress[0].ip}')
$ echo $SERVICE_IP
104.199.126.88
```

If `$SERVICE_IP` is blank, your cloud provider may have assigned a hostname to the load balancer rather than an IP address. Run the following command to retrieve the hostname, which you will use in place of `$SERVICE_IP` for subsequent commands.

```code
$ SERVICE_IP=$(kubectl get services teleport-cluster -o jsonpath='{.status.loadBalancer.ingress[0].hostname}')
```

Set up two DNS records: `teleport.example.com` for all traffic and
`*.teleport.example.com` for web apps using Application Access. We are assuming
that your domain name is `example.com` and `teleport` is the subdomain you have
assigned to your Teleport cluster.

Depending on whether the `$CLUSTER_ADDRESS` variable points to an IP address or
a domain name, the records will have the following details:

|Record Type|Domain Names|Value|
|---|---|---|
|A|teleport.example.com<br/>*.teleport.example.com|The IP address of your load balancer|
|CNAME|teleport.example.com<br/>*.teleport.example.com|The domain name of your load balancer|

Use the following command to confirm that your Teleport cluster is running:

```code
$ curl https://<Var name="cluster-name" />/webapi/ping

# {"auth":{"type":"local","second_factor":"otp","preferred_local_mfa":"otp","local":{"name":""},"private_key_policy":"none","has_motd":false},"proxy":{"kube":{"enabled":true,"listen_addr":"0.0.0.0:3026"},"ssh":{"listen_addr":"[::]:3023","tunnel_listen_addr":"0.0.0.0:3024","web_listen_addr":"0.0.0.0:3080","public_addr":"teleport.example.com:443"},"db":{"mysql_listen_addr":"0.0.0.0:3036"},"tls_routing_enabled":false},"server_version":"(=teleport.version=)","min_client_version":"11.0.0","cluster_name":"teleport.example.com"
```

## Step 2/3. Create a local user

A local user is a user based on a record that the Teleport Auth Service stores
in its backend. Create a local user `alice` who has access to Kubernetes group
`system:masters`.

Save this role as `member.yaml`:

```yaml
kind: role
version: v6
metadata:
  name: member
spec:
  allow:
    kubernetes_groups: ["system:masters"]
    kubernetes_labels:
      '*': '*'
    kubernetes_resources:
    - kind: "pod"
      namespace: "*"
      name: "*"
```

<Notice type="tip">

When a user with this role interacts with a Kubernetes cluster, the Kubernetes
Service modifies their requests to impersonate the groups named in
`kubernetes_groups`. If you have a group besides `system:masters` to assign the
user to, we recommend replacing `system:masters` with the name of that group.

</Notice>

Create the role and add a user by executing `tctl` commands against the Auth
Service pod:

```code
# Create the user's role
$ kubectl exec -i deployment/teleport-cluster-auth -- tctl create -f < member.yaml

# Generate an invite link for the user.
$ kubectl exec -ti deployment/teleport-cluster-auth -- tctl  users add alice --roles=member

# User "alice" has been created but requires a password. Share this URL with the user to
# complete user setup, link is valid for 1h:

# https://tele.example.com:443/web/invite/random-token-id-goes-here

# NOTE: Make sure tele.example.com:443 points at a Teleport proxy which users can access.
```

Open the link shown in your browser to activate the invitation for the user
`alice`. Follow the instructions to choose a password and register a
multi-factor authentication device.

## Step 3/3. Access your cluster

In this step you will log in to your Teleport cluster as the `alice` user we
registered earlier and access your Kubernetes cluster via Teleport.

```code
$ tsh login --proxy=<Var name="cluster-name" />:443 --user=alice
```

Once you're connected to the Teleport cluster, list Kubernetes clusters that you
can access via Teleport:

```code
$ tsh kube ls

# Kube Cluster Name Selected
# ----------------- --------
# teleport.example.com
```

Log in to the Kubernetes cluster and create a kubeconfig that you can use to
connect to the Kubernetes cluster. This kubeconfig is separate from the one we
used to install Teleport, making it easier to switch to the original kubeconfig
if during the installation process if something goes wrong.

Replace <Var name="kube-cluster-name" /> with the output of the `tsh kube ls`
command you ran earlier: 

```code
$ KUBECONFIG=$HOME/teleport-kubeconfig.yaml tsh kube login <Var name="kube-cluster-name" />
```

List pods in your cluster:

```code
$ KUBECONFIG=$HOME/teleport-kubeconfig.yaml kubectl get -n teleport-cluster pods
NAME                                      READY   STATUS    RESTARTS   AGE
pod/teleport-cluster-auth-57989d4-4q2ds   1/1     Running   0          22h
pod/teleport-cluster-auth-57989d4-rtrzn   1/1     Running   0          22h
pod/teleport-cluster-proxy-c6bf55-w96d2   1/1     Running   0          22h
pod/teleport-cluster-proxy-c6bf55-z256w   1/1     Running   0          22h
```

## Next steps

- **Set up Single Sign-On:** In this guide, we showed you how to create a local
  user, which is great for demo environments. For a production deployment, you
  should set up Single Sign-On with your provider of choice. See our [Single
  Sign-On guides](../access-controls/sso.mdx) for how to do this.
-  **Configure your Teleport deployment:** To see all of the options you can set
   in the values file for the `teleport-cluster` Helm chart, consult our
   [reference guide](../../reference/helm-reference/teleport-cluster.mdx).
- **Register resources:** You can register all of the Kubernetes clusters in
  your infrastructure with Teleport. To start, read our [Auto-Discovery
  guides](../kubernetes-access/discovery.mdx) to see how to automatically
  register every cluster in your cloud. You can also register servers,
  databases, applications, and Windows desktops.
- **Fine-tune your Kubernetes RBAC:** While the `alice` user you created in this
  guide can access the `system:masters` role, you can set up Teleport's RBAC to
  enable fine-grained controls for accessing Kubernetes resources. See our
  [Kubernetes Access Controls Guide](../kubernetes-access/controls.mdx) for more
  information.

